{% extends 'main/base.html' %}
{% load static %}

{% block title %}{{ product.name }} - BulavaArms{% endblock %}

{% block content %}
<div class="bg-[#f5f5f5] min-h-screen pb-12 font-sans text-gray-800">

    <!-- Breadcrumbs -->
    <div class="bg-white border-b border-gray-200">
        <div class="container mx-auto px-4">
            <nav class="flex text-xs md:text-sm text-gray-500 py-3 overflow-x-auto whitespace-nowrap">
                <a href="/" class="hover:text-primary-900 hover:underline transition-colors">Головна</a>
                <span class="mx-2 text-gray-300">/</span>
                <a href="{% url 'main:catalog' %}" class="hover:text-primary-900 hover:underline transition-colors">Каталог</a>
                <span class="mx-2 text-gray-300">/</span>
                <a href="{% url 'main:catalog' %}?category={{ product.category.slug }}" class="hover:text-primary-900 hover:underline transition-colors">{{ product.category.name }}</a>
                <span class="mx-2 text-gray-300">/</span>
                <span class="text-gray-900 font-medium truncate">{{ product.name }}</span>
            </nav>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6">

        <!-- Main Product Card -->
        <div class="bg-white rounded-none shadow-sm border border-gray-200 overflow-hidden mb-6">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-0">

                <!-- LEFT COLUMN: Images (lg:col-span-7) -->
                <div class="lg:col-span-7 p-4 md:p-6 lg:border-r border-gray-100">
                    <div class="relative mb-6">
                        <!-- Labels -->
                        <div class="absolute top-0 left-0 z-10 flex flex-col gap-2">
                            {% if product.status_discount %}
                                <span class="bg-red-600 text-white text-[10px] uppercase font-bold px-2 py-1 tracking-wider">Акція</span>
                            {% endif %}
                            <span class="bg-gray-800 text-white text-[10px] uppercase font-bold px-2 py-1 tracking-wider">
                                {{ product.get_product_type_display }}
                            </span>
                        </div>

                        <!-- Main Image -->
                        <div class="aspect-[4/3] flex items-center justify-center bg-white">
                            <img id="mainImage"
                                 src="{{ product.main_image.url }}"
                                 alt="{{ product.name }}"
                                 class="max-w-full max-h-[500px] object-contain transition-all duration-300">
                        </div>
                    </div>

                    <!-- Thumbnails -->
                    {% if product.images.all %}
                    <div class="flex gap-2 overflow-x-auto pb-2 hide-scrollbar justify-center lg:justify-start">
                        <!-- Main Image Thumbnail -->
                        <button onclick="changeImage('{{ product.main_image.url }}', this)"
                                class="w-20 h-20 flex-shrink-0 border border-primary-900 p-1 bg-white hover:opacity-80 transition-all thumbnail-btn active">
                            <img src="{{ product.main_image.url }}" class="w-full h-full object-contain">
                        </button>

                        <!-- Extra Images -->
                        {% for img in product.images.all %}
                        <button onclick="changeImage('{{ img.image.url }}', this)"
                                class="w-20 h-20 flex-shrink-0 border border-gray-200 p-1 bg-white hover:border-gray-400 transition-all thumbnail-btn">
                            <img src="{{ img.image.url }}" class="w-full h-full object-contain">
                        </button>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <!-- RIGHT COLUMN: Info (lg:col-span-5) -->
                <div class="lg:col-span-5 p-6 md:p-8 bg-white flex flex-col">

                    <!-- Title & Header -->
                    <div class="border-b border-gray-100 pb-5 mb-5">
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2 leading-tight uppercase tracking-tight">
                            {{ product.name }}
                        </h1>

                        <div class="flex flex-wrap items-center justify-between gap-3 text-sm">
                            <div class="text-gray-500">
                                Артикул: <span class="text-gray-900 font-semibold">{{ product.id|stringformat:"06d" }}</span>
                            </div>

                            <!-- Stock Status -->
                            {% if product.in_stock %}
                            <div class="flex items-center text-green-600 font-bold text-xs uppercase tracking-wide">
                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                                Є в наявності
                            </div>
                            {% else %}
                            <div class="flex items-center text-red-600 font-bold text-xs uppercase tracking-wide">
                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>
                                Немає в наявності
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Price Block -->
                    <div class="mb-6 bg-gray-50 p-4 rounded border border-gray-100 flex items-center justify-between">
                        <div>
                            {% if product.status_discount and product.discount_price %}
                                <div class="flex flex-col">
                                    <span class="text-gray-400 line-through text-sm font-medium">{{ product.price }} грн</span>
                                    <span class="text-3xl md:text-4xl font-extrabold text-red-600">
                                        {{ product.discount_price }} <span class="text-xl">грн</span>
                                    </span>
                                </div>
                            {% else %}
                                <span class="text-3xl md:text-4xl font-extrabold text-gray-900">
                                    {{ product.price }} <span class="text-xl font-bold text-gray-600">грн</span>
                                </span>
                            {% endif %}
                        </div>

                        {% if product.manufacturer %}
                        <div class="text-right">
                             <a href="{% url 'main:catalog' %}?manufacturer={{ product.manufacturer }}" class="group block">
                                <span class="text-xs text-gray-400 block uppercase">Виробник</span>
                                <span class="text-sm font-bold text-gray-800 group-hover:text-primary-900 underline decoration-dotted">{{ product.manufacturer }}</span>
                            </a>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Add to Cart -->
                    <form action="{% url 'cart:cart_add' product.id %}" method="post" class="mb-8">
                        {% csrf_token %}
                        <div class="flex flex-col sm:flex-row gap-3">
                            <!-- Quantity -->
                            <div class="flex items-center border border-gray-300 bg-white w-full sm:w-32 h-12">
                                <button type="button" onclick="decrementQty()" class="w-10 h-full flex items-center justify-center text-gray-500 hover:bg-gray-100 transition-colors font-bold text-lg">-</button>
                                <input type="number" name="quantity" id="quantity" value="1" min="1" max="10" class="w-full h-full text-center border-none focus:ring-0 text-gray-900 font-bold bg-transparent p-0">
                                <button type="button" onclick="incrementQty()" class="w-10 h-full flex items-center justify-center text-gray-500 hover:bg-gray-100 transition-colors font-bold text-lg">+</button>
                            </div>

                            <!-- Button -->
                            <button type="submit"
                                    class="flex-1 h-12 bg-gray-900 hover:bg-gray-800 text-white font-bold uppercase tracking-wider transition-all flex items-center justify-center gap-2 shadow-sm
                                    {% if not product.in_stock %}opacity-60 cursor-not-allowed hover:bg-gray-900{% endif %}"
                                    {% if not product.in_stock %}disabled{% endif %}>
                                {% if product.in_stock %}
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                                    Купити
                                {% else %}
                                    Повідомити
                                {% endif %}
                            </button>
                        </div>
                    </form>

                    <!-- Short Specs List -->
                    <div class="space-y-3 mb-6 border-t border-gray-100 pt-5">
                         {% if product.caliber %}
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500">Калібр:</span>
                            <span class="font-medium text-gray-900">{{ product.caliber }}</span>
                        </div>
                        {% endif %}
                         {% if product.material %}
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500">Матеріал:</span>
                            <span class="font-medium text-gray-900">{{ product.material }}</span>
                        </div>
                        {% endif %}
                         {% if product.color %}
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500">Колір:</span>
                            <span class="font-medium text-gray-900">{{ product.color }}</span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Service Benefits -->
                    <div class="mt-auto bg-[#f9fafb] p-4 rounded border border-gray-100 grid grid-cols-2 gap-y-4 gap-x-2">
                        <div class="flex items-start gap-2">
                            <svg class="w-5 h-5 text-gray-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <div>
                                <div class="text-xs font-bold text-gray-900 uppercase">Гарантія</div>
                                <div class="text-[11px] text-gray-500 leading-tight">Офіційна від виробника</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <svg class="w-5 h-5 text-gray-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                            <div>
                                <div class="text-xs font-bold text-gray-900 uppercase">Доставка</div>
                                <div class="text-[11px] text-gray-500 leading-tight">Швидка відправка</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <svg class="w-5 h-5 text-gray-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                            <div>
                                <div class="text-xs font-bold text-gray-900 uppercase">Самовивіз</div>
                                <div class="text-[11px] text-gray-500 leading-tight">З магазину в Києві</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <svg class="w-5 h-5 text-gray-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
                            <div>
                                <div class="text-xs font-bold text-gray-900 uppercase">Оплата</div>
                                <div class="text-[11px] text-gray-500 leading-tight">Готівка, Карта, Б/Н</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Details Section (Tabs style) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Left: Description -->
            <div class="lg:col-span-2">
                <div class="bg-white shadow-sm border border-gray-200">
                    <div class="border-b border-gray-200 bg-gray-50 px-6 py-4">
                        <h2 class="text-lg font-bold text-gray-900 uppercase tracking-wide">Опис товару</h2>
                    </div>
                    <div class="p-6 md:p-8">
                        <div class="prose prose-sm prose-gray max-w-none">
                            {% if product.description %}
                                {{ product.description|linebreaks }}
                            {% else %}
                                <p class="text-gray-400 italic">Опис відсутній.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Full Characteristics Table -->
            <div class="lg:col-span-1">
                <div class="bg-white shadow-sm border border-gray-200 sticky top-4">
                    <div class="border-b border-gray-200 bg-gray-50 px-6 py-4">
                        <h2 class="text-lg font-bold text-gray-900 uppercase tracking-wide">Характеристики</h2>
                    </div>

                    <div class="text-sm">
                        {% if product.manufacturer %}
                        <div class="flex justify-between px-6 py-3 border-b border-gray-100 bg-white hover:bg-gray-50">
                            <span class="text-gray-500">Виробник</span>
                            <span class="text-gray-900 font-medium text-right">{{ product.manufacturer }}</span>
                        </div>
                        {% endif %}

                        {% if product.product_type %}
                        <div class="flex justify-between px-6 py-3 border-b border-gray-100 bg-[#f9fafb] hover:bg-gray-50">
                            <span class="text-gray-500">Тип</span>
                            <span class="text-gray-900 font-medium text-right">{{ product.get_product_type_display }}</span>
                        </div>
                        {% endif %}

                        {% if product.caliber %}
                        <div class="flex justify-between px-6 py-3 border-b border-gray-100 bg-white hover:bg-gray-50">
                            <span class="text-gray-500">Калібр</span>
                            <span class="text-gray-900 font-medium text-right">{{ product.caliber }}</span>
                        </div>
                        {% endif %}

                        {% if product.material %}
                        <div class="flex justify-between px-6 py-3 border-b border-gray-100 bg-[#f9fafb] hover:bg-gray-50">
                            <span class="text-gray-500">Матеріал</span>
                            <span class="text-gray-900 font-medium text-right">{{ product.material }}</span>
                        </div>
                        {% endif %}

                        {% if product.color %}
                        <div class="flex justify-between px-6 py-3 border-b border-gray-100 bg-white hover:bg-gray-50">
                            <span class="text-gray-500">Колір</span>
                            <span class="text-gray-900 font-medium text-right">{{ product.color }}</span>
                        </div>
                        {% endif %}

                        {% if product.size %}
                        <div class="flex justify-between px-6 py-3 border-b border-gray-100 bg-[#f9fafb] hover:bg-gray-50">
                            <span class="text-gray-500">Розмір</span>
                            <span class="text-gray-900 font-medium text-right">{{ product.size }}</span>
                        </div>
                        {% endif %}

                        <div class="flex justify-between px-6 py-3 bg-white">
                            <span class="text-gray-500">Гарантія</span>
                            <span class="text-gray-900 font-medium text-right">12 міс.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Clean inputs */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    input[type=number] {
        -moz-appearance: textfield;
    }
    .hide-scrollbar::-webkit-scrollbar {
        display: none;
    }
    .hide-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    /* Active thumbnail border */
    .thumbnail-btn.active {
        border-color: #111827; /* gray-900 */
        opacity: 1;
    }
</style>

<script>
    function changeImage(src, btn) {
        const mainImage = document.getElementById('mainImage');
        // Simple fade
        mainImage.style.opacity = '0.7';

        setTimeout(() => {
            mainImage.src = src;
            mainImage.style.opacity = '1';
        }, 150);

        document.querySelectorAll('.thumbnail-btn').forEach(el => {
            el.classList.remove('active', 'border-primary-900', 'border-gray-900');
            el.classList.add('border-gray-200');
        });
        btn.classList.remove('border-gray-200');
        btn.classList.add('active');
    }

    function incrementQty() {
        const input = document.getElementById('quantity');
        const current = parseInt(input.value);
        if (current < 10) input.value = current + 1;
    }

    function decrementQty() {
        const input = document.getElementById('quantity');
        const current = parseInt(input.value);
        if (current > 1) input.value = current - 1;
    }
</script>
{% endblock %}